<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Particle System - Mok</title>
    <link rel="stylesheet" href="static/gicss/styles.css">
    <!-- ES6 Module Import Map for Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
        }
    }
    </script>
    <script src="https://unpkg.com/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://unpkg.com/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://unpkg.com/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://unpkg.com/@mediapipe/hands/hands.js"></script>
</head>

<body>
    <div id="topBtns">
        <button id="debugPanelBtn" onclick="toggleDebug()">调试面板</button>
        <button id="downloadCertBtn" onclick="downloadCert()" style="display: none;">下载证书</button>
    </div>
    <div id="cameraSwitchBtns" style="display: none;">
        <button id="frontCamBtn" onclick="switchCamera(true)">前置相机</button>
        <button id="backCamBtn" onclick="switchCamera(false)">后置相机</button>
    </div>
    <div id="qr-container">
        <h2 class="qr-title">扫码访问</h2>
        <img src="{{ url_for('generate_qr') }}" alt="QR Code" id="qr-image">
    </div>
    <div id="loading">
        <span id="loading-text">系统初始化中…<br>请允许摄像头权限</span>
        <button id="skip-loading-btn" style="display: none; margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; background: rgba(255,255,255,0.2); border: 2px solid #00ffff; color: #00ffff; border-radius: 5px;" onclick="skipHandsLoading()">跳过手势检测，直接体验</button>
    </div>
    <div id="canvas-container"></div>
    <video id="video-element" autoplay playsinline webkit-playsinline muted></video>
    <div id="debug-panel" class="hidden">
        <div class="debug-title">调试信息</div>
        <div class="debug-section">性能监控</div>
        <div>FPS: <span id="debug-fps">-</span></div>
        <div title="负载基于帧时间估算，100%=满载">CPU: <span id="debug-cpu">-</span></div>
        <div>内存使用: <span id="debug-memory">-</span></div>
        <div>粒子数量: <span id="debug-particle-count">-</span></div>
        <div class="debug-section">系统信息</div>
        <div>屏幕尺寸: <span id="debug-screen-size">-</span></div>
        <div>手势状态: <span id="debug-hand-status">未检测</span></div>
        <div>摄像头流: <span id="debug-stream-status">-</span></div>
        <div>运行模式: <span id="debug-run-mode">-</span></div>
        <div class="debug-section">手势交互</div>
        <div>手势类型: <span id="debug-gesture-type">-</span></div>
        <div>手位置: <span id="debug-hand-pos">-</span></div>
        <div>粒子位置: <span id="debug-particle-pos">-</span></div>
        <div>跟随速度: <span id="debug-follow-vel">-</span></div>
        <div>最后更新: <span id="debug-last-update">-</span></div>
        <div>错误信息: <span id="debug-error">无</span></div>
        <button id="debug-toggle" onclick="toggleDebug()">隐藏调试</button>
    </div>
    
    <!-- Load main application module after all dependencies -->
    <script type="module" src="static/gijss/gestureHandling.js"></script>
</body>

</html>